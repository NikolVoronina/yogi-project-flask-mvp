{% extends "base.html" %}

{% block content %}
<style>
  :root {
    --yogi-green: #BAD341;
    --yogi-dark: #1E1E1E;
    --yogi-pink: #D341C4;
    --yogi-muted: #666666;
  }

  .schedule-page {
    color: var(--yogi-dark);
  }

  .schedule-header-main {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    gap: 16px;
    margin-bottom: 20px;
  }

  .schedule-title-block h1 {
    margin: 0 0 6px;
    font-size: 26px;
  }

  .schedule-title-block p {
    margin: 0;
    font-size: 13px;
    color: var(--yogi-muted);
  }

  .schedule-range-pill {
    display: inline-flex;
    align-items: center;
    padding: 8px 14px;
    border-radius: 999px;
    border: 1px solid #e5e7eb;
    background: #f9fafb;
    font-size: 12px;
  }

  /* Фильтры */
  .schedule-filters-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 16px;
  }

  .filter-pill {
    display: inline-flex;
    align-items: center;
    padding: 6px 12px;
    border-radius: 999px;
    border: 1px solid #e5e7eb;
    background: #ffffff;
    font-size: 12px;
    color: #4b5563;
    text-decoration: none;
    cursor: pointer;
  }

  .filter-pill:hover {
    background: #f3f4f6;
  }

  .filter-pill.active {
    background: var(--yogi-green);
    border-color: var(--yogi-green);
    color: #111827;
    font-weight: 500;
  }

  .filter-pill.prenatal {
    border-color: #f9a8d4;
  }

  /* Карточка расписания */
  .schedule-card-full {
    border-radius: 24px;
    border: 1px solid #e5e7eb;
    padding: 18px 16px;
    background: #fafafa;
  }

  .schedule-grid {
    display: grid;
    grid-template-columns: repeat(6, minmax(0, 1fr));
    gap: 10px;
    font-size: 11px;
  }

  .schedule-day-header {
    font-weight: 500;
    margin-bottom: 6px;
    text-align: center;
  }

  .schedule-day-date {
    font-size: 10px;
    color: var(--yogi-muted);
  }

  .schedule-slot {
    border-radius: 16px;
    padding: 8px 8px;
    background: #f3f4f6;
    border: 1px solid #e5e7eb;
    margin-bottom: 6px;
  }

  .schedule-slot--green {
    background: #f8fbe8;
    border-color: #d9e88d;
  }

  .schedule-slot--pink {
    background: #fbe8fb;
    border-color: #f0b8ee;
  }

  .schedule-slot-title {
    font-weight: 500;
    font-size: 11px;
    margin-bottom: 2px;
  }

  .schedule-slot-time {
    font-size: 10px;
    color: var(--yogi-muted);
    margin-bottom: 3px;
  }

  .schedule-slot-meta {
    font-size: 10px;
    color: #4b5563;
    margin-bottom: 4px;
  }

  .schedule-slot button {
    border-radius: 999px;
    border: none;
    padding: 3px 10px;
    font-size: 10px;
    cursor: pointer;
    background: #ffffff;
  }

  .schedule-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    margin-top: 12px;
    font-size: 11px;
    color: var(--yogi-muted);
  }

  .legend-dot {
    width: 10px;
    height: 10px;
    border-radius: 999px;
    margin-right: 6px;
    display: inline-block;
  }

  .dot-green { background: #f8fbe8; border: 1px solid #d9e88d; }
  .dot-pink { background: #fbe8fb; border: 1px solid #f0b8ee; }
  .dot-grey { background: #e5e7eb; border: 1px solid #d1d5db; }

  @media (max-width: 900px) {
    .schedule-grid {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
  }
</style>

<div class="schedule-page">

  <div class="schedule-header-main">
    <div class="schedule-title-block">
      <h1>Schedule</h1>
      <p>Filter classes by category og finn det som passer deg best.</p>
    </div>
    <div class="schedule-range-pill">
      {% if week_days %}
        {{ week_days[0].date.strftime("%d %B") }} – {{ week_days[-1].date.strftime("%d %B") }}
      {% endif %}
    </div>
  </div>

  <!-- Фильтры по категориям -->
  <div class="schedule-filters-row">
    <a href="{{ url_for('schedule', category='all') }}"
       class="filter-pill {% if current_category == 'all' %}active{% endif %}">
      All classes
    </a>

    {% for cat in categories %}
      <a href="{{ url_for('schedule', category=cat) }}"
         class="filter-pill 
                {% if cat == 'prenatal' %}prenatal{% endif %}
                {% if current_category == cat %} active{% endif %}">
        {{ cat|capitalize }}
      </a>
    {% endfor %}
  </div>

  <!-- Сетка расписания -->
  <div class="schedule-card-full">
    <div class="schedule-grid">
      {% for day in week_days %}
        <div>
          <div class="schedule-day-header">
            {{ day.weekday_label }}
            <div class="schedule-day-date">
              {{ day.date.strftime("%d %b") }}
            </div>
          </div>

          {% set day_classes = classes_by_date.get(day.date) %}

          {% if day_classes %}
            {% for cls in day_classes %}
              {% set cls_color = 'schedule-slot--green' %}
              {% if cls.category == 'prenatal' %}
                {% set cls_color = 'schedule-slot--pink' %}
              {% endif %}

              <div class="schedule-slot {{ cls_color }}">
                <div class="schedule-slot-title">{{ cls.title }}</div>

                <div class="schedule-slot-time">
                  {{ cls.start_time_str }} – {{ cls.end_time_str }}
                </div>

                <div class="schedule-slot-meta">
                  Level: {{ cls.level }}
                  {% if cls.category == 'prenatal' %}
                    · Prenatal
                  {% endif %}
                  <br>
                  Spots: {{ cls.booked_spots }}/{{ cls.max_spots }}
                </div>

                {% if cls.booked_spots < cls.max_spots %}
                  <a href="{{ url_for('book', class_id=cls.id) }}">
                    <button type="button">Book</button>
                  </a>
                {% else %}
                  <button type="button" disabled style="opacity:0.5;">Full</button>
                {% endif %}
              </div>
            {% endfor %}
          {% else %}
            <div style="font-size:10px; color:#999; text-align:center; margin-top:10px;">
              No classes
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    <div class="schedule-legend">
      <span><span class="legend-dot dot-green"></span>For everyone</span>
      <span><span class="legend-dot dot-pink"></span>Prenatal yoga</span>
      <span><span class="legend-dot dot-grey"></span>Overbooked / not available</span>
    </div>
  </div>

</div>
{% endblock %}
